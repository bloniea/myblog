import{g as T,h as A,f as G,r as d,a as b,e as H,X as U,V as X,o as f,C as Y,c as y,y as n,B as x,p as a,u as c,Y as $,G as j,H as u,t as g,v as k,L as F,M as J}from"./vendor.b1f7e7cf.js";/* empty css                        */import{M as K}from"./index.8df22219.js";import{_ as O}from"./index.d7a63edd.js";import{_ as P}from"./index.3cf016b9.js";import{L as Q}from"./index.0fe4c1da.js";import{_ as W,a as Z,g as tt,d as et,e as at,c as st,f as ot}from"./index.5f53ded5.js";import{b as ct,c as I}from"./fetch.601d8262.js";/* empty css                                                          *//* empty css                */var nt="/assets/head-bg.6c0b5954.png";const C=m=>(F("data-v-96455a2a"),m=m(),J(),m),it={key:1},lt={class:"wraper"},rt={class:"image-slot"},dt={class:"article-header"},ut=C(()=>a("div",{class:"head-bg"},null,-1)),mt={class:"title-box"},_t={class:"title"},ft={class:"title-name"},gt={class:"info"},vt={class:"article-info"},pt=C(()=>a("i",{class:"iconfont icondate"},null,-1)),ht=C(()=>a("i",{class:"iconfont iconfenlei1"},null,-1)),yt={class:"source"},kt=k(" source: "),Ct={class:"source-name"},St={class:"article-content"},wt={class:"star"},Lt={setup(m){const i=new T,S=A(()=>i.state.userinfo),w=A(()=>i.state.status),B=G(),v=d(!0),e=b({article:{},comments:[],id:B.params.id});(async t=>{v.value=!0;const s=await ct(t);e.article=s.data.data,v.value=!1,$(()=>{D(t)}),w.value&&L()})(e.id);const p=b({pagenum:1,pagesize:10,orderBy:-1}),l=d(0),D=async t=>{const s=j.service({target:".comments",lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),o=await I(t,p);o.status===200&&o.ok&&(e.comments=o.data.data,l.value=o.data.total),s.close()},h=d(!1),q=async()=>{h.value=!0;const t=await I(e.id,p);t.status===200&&t.ok&&(h.value=!1,t.data.data,e.comments=[...e.comments,...t.data.data],l.value=t.data.total)},z=()=>{p.pagenum++,q()},_=d(!1),E=async t=>{const s={article_id:e.article._id,user_id:S.value._id,content:t.content};t.to_comment_id&&(s.to_comment_id=t.to_comment_id),_.value=!0;const o=await Z(s);o.status===200&&o.ok?(_.value=!1,u.success("\u8BC4\u8BBA\u6210\u529F"),i.commit("setCommentIsNull",!0),e.comments.length==l.value&&(e.comments.unshift(o.data.data),l.value++)):(_.value=!1,u.error("\u63D0\u4EA4\u8D85\u65F6"))},r=d(!1),L=async()=>{const t=await tt(e.article._id);t.status===200&&t.ok&&(r.value=!0)},M=async()=>{if(w.value){const t={user_id:S.value.user_id,article_id:e.article._id},s=await et(t);s.status===200&&s.ok&&(u.success("\u6536\u85CF\u6210\u529F"),r.value=!0)}else i.commit("setIsShowLogin",!0),u.error("\u8BF7\u5148\u767B\u5F55")},N=async()=>{const t=await at(e.article._id);t.status===200&&t.ok&&(u.success("\u53D6\u6D88\u6536\u85CF\u6210\u529F"),r.value=!1)},V=H(),R=(t,s)=>{V.push({name:"CategoryDetail",params:{id:t},query:{name:s}})};return U(()=>i.state.status,t=>{t?L():r.value=!1}),(t,s)=>{const o=X;return v.value?(f(),Y(Q,{key:0})):(f(),y("div",it,[n(K,null,{default:x(()=>[a("article",null,[a("div",lt,[n(o,{lazy:"",fit:"cover",src:c(e).article.img_url},{error:x(()=>[a("div",rt,[n(o,{lazy:"",src:c(st).defaultImgUrl,fit:"cover"},null,8,["src"])])]),_:1},8,["src"])]),a("div",dt,[n(o,{lazy:"",fit:"cover",src:c(nt)},null,8,["src"]),ut,a("div",mt,[a("div",_t,[a("div",ft,g(c(e).article.title),1)]),a("div",gt,[a("div",vt,[a("span",null,[pt,k(" "+g(c(ot)(c(e).article.created_at)),1)]),a("span",{onClick:s[0]||(s[0]=bt=>R(c(e).article.category_id,c(e).article.category.cat_name)),class:"category_name"},[ht,k(" "+g(c(e).article.category.cat_name),1)])]),a("div",yt,[kt,a("span",Ct,g(c(e).article.img_source),1)])])])]),a("div",St,[n(O,{html:c(e).article.content},null,8,["html"])])])]),_:1}),a("div",wt,[r.value?(f(),y("i",{key:0,class:"iconfont iconstarton stared",title:"\u53D6\u6D88\u6536\u85CF",onClick:N})):(f(),y("i",{key:1,class:"iconfont iconstaroff",title:"\u6536\u85CF",onClick:M}))]),n(P,{onSaveComment:E,comments:c(e).comments,total:l.value,onLoadAdd:z,btnLoading:_.value,addLoading:h.value},null,8,["comments","total","btnLoading","addLoading"])]))}}};var Rt=W(Lt,[["__scopeId","data-v-96455a2a"]]);export{Rt as default};
