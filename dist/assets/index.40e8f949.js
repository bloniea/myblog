import{a as M,m as P,W as j,X as D,o as c,c as v,u as o,r as I,h as W,i as E,f as X,e as t,t as g,C as R,B as b,x as $,v as p,y as l,Y as Q,Z as tt,_ as et,s as st,A as ot,F as at,q as nt,L as Y,M as Z,H as L,K as ct,J as lt,$ as it,g as rt,U as dt}from"./vendor.bee95a75.js";/* empty css                        */import{M as mt}from"./index.980ab3dc.js";/* empty css                                                          */import{_ as K,f as G,a as ut,g as _t,d as vt,e as pt,c as ht}from"./index.3f412d7c.js";/* empty css                */import{L as gt}from"./index.886f8a82.js";import{b as ft,c as J}from"./fetch.bab85dd8.js";const yt=["innerHTML"],kt={props:{html:String},setup(r){const u=r,_=M({nHtml:String}),n=d=>P.parse(u.html,{renderer:new P.Renderer,highlight:function(f,s){const N=j.getLanguage(s)?s:"plaintext";return j.highlight(f,{language:N}).value},langPrefix:"hljs language-"});return _.nHtml=n(u.html),D(()=>u.html,d=>_.nHtml=n()),(d,f)=>(c(),v("div",{class:"md-to-html",innerHTML:o(_).nHtml},null,8,yt))}};var B=K(kt,[["__scopeId","data-v-5a5ebec8"]]);const O=r=>(Y("data-v-723dd106"),r=r(),Z(),r),wt={class:"comments"},Ct={class:"title"},$t=O(()=>t("span",null,[p("\u652F\u6301 "),t("span",{class:"special"},"markdown"),p(" \u8BED\u6CD5")],-1)),It={class:"comments-box"},bt={class:"tip_login"},St=p("\u767B\u5F55\u8FDB\u884C\u8BC4\u8BBA"),Lt={class:"comment_form"},xt={key:1,class:"input",id:"commentInput"},At={key:0,class:"to-user"},Ht={class:"comments-input"},Tt=["onKeyup"],Et={key:1,placeholder:"\u9884\u89C8",class:"shadow pre"},Mt={class:"submit vsubmit"},Nt=p("\u9884\u89C8"),zt=p("\u63D0\u4EA4"),Bt={class:"list_box",ref:"commentsList"},Dt={class:"avatar"},qt={class:"comment-content bg-shadow"},Ut={class:"title-info"},Vt={class:"username"},Rt={class:"created"},Kt=["onClick"],Ft=O(()=>t("i",{class:"iconfont iconreply"},null,-1)),Pt=[Ft],jt={key:0,class:"reply-content"},Jt={class:"name"},Wt={class:"content"},Xt={class:"content"},Yt={key:0,class:"add"},Zt=p("\u52A0\u8F7D\u66F4\u591A"),Gt={props:{comments:Array,total:Number,btnLoading:!1,addLoading:!1},emits:["saveComment","loadAdd"],setup(r,{emit:u}){const _=r,n=M({comments:[],previewContent:"\u9884\u89C8",commnetInput:""});D(()=>n.commnetInput,m=>n.previewContent=m||"\u9884\u89C8");const d=I(""),f=()=>{d.value="",d.value=""},s=M({content:"",to_user_id:null,level:1,to_comment_id:null}),N=()=>{if(d.value||(s.to_comment_id=null),!n.commnetInput)return L.error("\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9");s.content=n.commnetInput,w.commit("setCommentIsNull",!1),u("saveComment",s)},x=m=>{window.location.href="#commentInput";const y=document.documentElement.scrollTop||document.body.scrollTop,e=document.documentElement.clientHeight||document.body.clientHeight;document.documentElement.scrollHeight,window.scrollTo(0,y-e/4),console.log(),s.to_comment_id=m._id,s.to_user_id=m.user_id,d.value=m.user.name},k=m=>{m.target.selectionStart||(d.value=""),s.level=1},w=W(),A=E(()=>w.state.userinfo),H=E(()=>w.state.status);D(()=>w.state.commentStatus,m=>m?n.commnetInput="":n.commnetInput);const T=I(!1),S=()=>{T.value=!T.value},q=E(()=>_.comments.length<_.total),C=()=>{u("loadAdd")},z=()=>{w.commit("setIsShowLogin",!0)},U=X(),V=()=>{U.push("/me")};return(m,y)=>{const e=ct,a=lt,h=it;return c(),v("div",wt,[t("div",Ct,[t("span",null,g(_.total)+"\u6761\u8BC4\u8BBA",1),$t]),t("div",It,[t("div",bt,[o(H)?$("",!0):(c(),R(e,{key:0,onClick:z},{default:b(()=>[St]),_:1}))]),t("div",Lt,[o(H)?(c(),R(a,{key:0,size:50,src:o(A).avatar_url,class:"user-avatar",onClick:V},null,8,["src"])):$("",!0),o(H)?(c(),v("div",xt,[d.value?(c(),v("div",At,[p(" @"+g(d.value)+" ",1),l(h,{class:"close",onClick:f},{default:b(()=>[l(o(Q))]),_:1})])):$("",!0),t("div",Ht,[tt(t("textarea",{rows:"4",type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u8BC4\u8BBA\u5185\u5BB9","onUpdate:modelValue":y[0]||(y[0]=i=>o(n).commnetInput=i),class:st(`shadow ${d.value?"is-reply":""}`),onKeyup:ot(k,["delete"])},`
            `,42,Tt),[[et,o(n).commnetInput]])]),T.value?(c(),v("div",Et,[l(B,{html:o(n).previewContent},null,8,["html"])])):$("",!0),t("div",Mt,[l(e,{round:"",onClick:S},{default:b(()=>[Nt]),_:1}),l(e,{round:"",onClick:y[1]||(y[1]=i=>N(m.ruleFormRef)),loading:_.btnLoading},{default:b(()=>[zt]),_:1},8,["loading"])])])):$("",!0)])]),t("div",Bt,[(c(!0),v(at,null,nt(r.comments,i=>(c(),v("div",{class:"list",key:i._id},[t("div",Dt,[l(a,{size:50,src:i.user.avatar_url},null,8,["src"])]),t("div",qt,[t("div",Ut,[t("span",Vt,g(i.user.name),1),t("span",Rt,g(o(G)(i.created_at)),1),t("span",{class:"reply",title:"\u56DE\u590D",onClick:fe=>x(i)},Pt,8,Kt)]),i.to_comment&&i.to_comment_user?(c(),v("div",jt,[t("div",Jt,"@"+g(i.to_comment_user.name),1),t("div",Wt,[l(B,{html:i.to_comment.content},null,8,["html"])])])):$("",!0),t("div",Xt,[l(B,{html:i.content},null,8,["html"])])])]))),128))],512),o(q)?(c(),v("div",Yt,[l(e,{onClick:C,loading:_.addLoading},{default:b(()=>[Zt]),_:1},8,["loading"])])):$("",!0)])}}};var Ot=K(Gt,[["__scopeId","data-v-723dd106"]]),Qt="/assets/head-bg.6c0b5954.png";const F=r=>(Y("data-v-50cadf8b"),r=r(),Z(),r),te={key:1},ee={class:"wraper"},se={class:"image-slot"},oe={class:"article-header"},ae=F(()=>t("div",{class:"head-bg"},null,-1)),ne={class:"title-box"},ce={class:"title"},le={class:"title-name"},ie={class:"info"},re={class:"article-info"},de=F(()=>t("i",{class:"iconfont icondate"},null,-1)),me=F(()=>t("i",{class:"iconfont iconfenlei1"},null,-1)),ue={class:"source"},_e=p(" source: "),ve={class:"source-name"},pe={class:"article-content"},he={class:"star"},ge={setup(r){const u=new W,_=E(()=>u.state.userinfo),n=E(()=>u.state.status),d=rt(),f=I(!0),s=M({article:{},comments:[],id:d.params.id});(async e=>{f.value=!0;const a=await ft(e);s.article=a.data.data,f.value=!1,w(e),n.value&&z()})(s.id);const x=M({pagenum:1,pagesize:10,orderBy:-1}),k=I(0),w=async e=>{const a=await J(e,x);a.status===200&&a.ok&&(s.comments=a.data.data,k.value=a.data.total)},A=I(!1),H=async()=>{A.value=!0;const e=await J(s.id,x);e.status===200&&e.ok&&(A.value=!1,e.data.data,s.comments=[...s.comments,...e.data.data],k.value=e.data.total)},T=()=>{x.pagenum++,H()},S=I(!1),q=async e=>{const a={article_id:s.article._id,user_id:_.value._id,content:e.content};e.to_comment_id&&(a.to_comment_id=e.to_comment_id),S.value=!0;const h=await ut(a);h.status===200&&h.ok?(S.value=!1,L.success("\u8BC4\u8BBA\u6210\u529F"),u.commit("setCommentIsNull",!0),s.comments.length==k.value&&(s.comments.unshift(h.data.data),k.value++)):(S.value=!1,L.error("\u63D0\u4EA4\u8D85\u65F6"))},C=I(!1),z=async()=>{const e=await _t(s.article._id);e.status===200&&e.ok&&(C.value=!0)},U=async()=>{if(n.value){const e={user_id:_.value.user_id,article_id:s.article._id},a=await vt(e);a.status===200&&a.ok&&(L.success("\u6536\u85CF\u6210\u529F"),C.value=!0)}else u.commit("setIsShowLogin",!0),L.error("\u8BF7\u5148\u767B\u5F55")},V=async()=>{const e=await pt(s.article._id);e.status===200&&e.ok&&(L.success("\u53D6\u6D88\u6536\u85CF\u6210\u529F"),C.value=!1)},m=X(),y=(e,a)=>{m.push({name:"CategoryDetail",params:{id:e},query:{name:a}})};return D(()=>u.state.status,e=>{e?z():C.value=!1}),(e,a)=>{const h=dt;return f.value?(c(),R(gt,{key:0})):(c(),v("div",te,[l(mt,null,{default:b(()=>[t("article",null,[t("div",ee,[l(h,{lazy:"",fit:"cover",src:o(s).article.img_url},{error:b(()=>[t("div",se,[l(h,{lazy:"",src:o(ht).defaultImgUrl,fit:"cover"},null,8,["src"])])]),_:1},8,["src"])]),t("div",oe,[l(h,{lazy:"",fit:"cover",src:o(Qt)},null,8,["src"]),ae,t("div",ne,[t("div",ce,[t("div",le,g(o(s).article.title),1)]),t("div",ie,[t("div",re,[t("span",null,[de,p(" "+g(o(G)(o(s).article.created_at)),1)]),t("span",{onClick:a[0]||(a[0]=i=>y(o(s).article.category_id,o(s).article.category.cat_name)),class:"category_name"},[me,p(" "+g(o(s).article.category.cat_name),1)])]),t("div",ue,[_e,t("span",ve,g(o(s).article.img_source),1)])])])]),t("div",pe,[l(B,{html:o(s).article.content},null,8,["html"])])])]),_:1}),t("div",he,[C.value?(c(),v("i",{key:0,class:"iconfont iconstarton stared",title:"\u53D6\u6D88\u6536\u85CF",onClick:V})):(c(),v("i",{key:1,class:"iconfont iconstaroff",title:"\u6536\u85CF",onClick:U}))]),l(Ot,{onSaveComment:q,comments:o(s).comments,total:k.value,onLoadAdd:T,btnLoading:S.value,addLoading:A.value},null,8,["comments","total","btnLoading","addLoading"])]))}}};var Le=K(ge,[["__scopeId","data-v-50cadf8b"]]);export{Le as default};
