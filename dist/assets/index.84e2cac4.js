import{g as T,h as b,f as F,r as d,a as x,e as G,X as H,V as U,o as f,C as X,c as y,y as n,B as I,p as a,u as c,Y,G as $,H as u,t as g,v as k,L as j,M as J}from"./vendor.b1f7e7cf.js";/* empty css                        */import{M as K}from"./index.8e98b2b3.js";import{_ as O}from"./index.f7084da9.js";import{_ as P}from"./index.ae3c422f.js";import{L as Q}from"./index.72fe7916.js";import{_ as W,a as Z,g as tt,d as et,e as at,c as st,f as ot}from"./index.29fd4036.js";import{b as ct,c as B}from"./fetch.601d8262.js";/* empty css                                                          *//* empty css                */var nt="/assets/head-bg.6c0b5954.png";const C=m=>(j("data-v-5ece90e8"),m=m(),J(),m),it={key:1},lt={class:"wraper"},rt={class:"image-slot"},dt={class:"article-header"},ut=C(()=>a("div",{class:"head-bg"},null,-1)),mt={class:"title-box"},_t={class:"title"},ft={class:"title-name"},gt={class:"info"},pt={class:"article-info"},vt=C(()=>a("i",{class:"iconfont icondate"},null,-1)),ht=C(()=>a("i",{class:"iconfont iconfenlei1"},null,-1)),yt={class:"source"},kt=k(" source: "),Ct={class:"source-name"},St={class:"article-content"},wt={class:"star"},Lt={setup(m){const i=new T,S=b(()=>i.state.userinfo),w=b(()=>i.state.status),D=F(),p=d(!0),e=x({article:{},comments:[],id:D.params.id});(async t=>{p.value=!0;const s=await ct(t);s.status==200&&s.ok?(e.article=s.data.data,p.value=!1,Y(()=>{N(t)}),w.value&&L()):A.push({name:"NotFound"})})(e.id);const v=x({pagenum:1,pagesize:10,orderBy:-1}),l=d(0),N=async t=>{const s=$.service({target:".comments",lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),o=await B(t,v);o.status===200&&o.ok&&(e.comments=o.data.data,l.value=o.data.total),s.close()},h=d(!1),q=async()=>{h.value=!0;const t=await B(e.id,v);t.status===200&&t.ok&&(h.value=!1,t.data.data,e.comments=[...e.comments,...t.data.data],l.value=t.data.total)},z=()=>{v.pagenum++,q()},_=d(!1),E=async t=>{const s={article_id:e.article._id,user_id:S.value._id,content:t.content};t.to_comment_id&&(s.to_comment_id=t.to_comment_id),_.value=!0;const o=await Z(s);o.status===200&&o.ok?(_.value=!1,u.success("\u8BC4\u8BBA\u6210\u529F"),i.commit("setCommentIsNull",!0),e.comments.length==l.value&&(e.comments.unshift(o.data.data),l.value++)):(_.value=!1,u.error("\u63D0\u4EA4\u8D85\u65F6"))},r=d(!1),L=async()=>{const t=await tt(e.article._id);t.status===200&&t.ok&&(r.value=!0)},M=async()=>{if(w.value){const t={user_id:S.value.user_id,article_id:e.article._id},s=await et(t);s.status===200&&s.ok&&(u.success("\u6536\u85CF\u6210\u529F"),r.value=!0)}else i.commit("setIsShowLogin",!0),u.error("\u8BF7\u5148\u767B\u5F55")},V=async()=>{const t=await at(e.article._id);t.status===200&&t.ok&&(u.success("\u53D6\u6D88\u6536\u85CF\u6210\u529F"),r.value=!1)},A=G(),R=(t,s)=>{A.push({name:"CategoryDetail",params:{id:t},query:{name:s}})};return H(()=>i.state.status,t=>{t?L():r.value=!1}),(t,s)=>{const o=U;return p.value?(f(),X(Q,{key:0})):(f(),y("div",it,[n(K,null,{default:I(()=>[a("article",null,[a("div",lt,[n(o,{lazy:"",fit:"cover",src:c(e).article.img_url},{error:I(()=>[a("div",rt,[n(o,{lazy:"",src:c(st).defaultImgUrl,fit:"cover"},null,8,["src"])])]),_:1},8,["src"])]),a("div",dt,[n(o,{lazy:"",fit:"cover",src:c(nt)},null,8,["src"]),ut,a("div",mt,[a("div",_t,[a("div",ft,g(c(e).article.title),1)]),a("div",gt,[a("div",pt,[a("span",null,[vt,k(" "+g(c(ot)(c(e).article.created_at)),1)]),a("span",{onClick:s[0]||(s[0]=bt=>R(c(e).article.category_id,c(e).article.category.cat_name)),class:"category_name"},[ht,k(" "+g(c(e).article.category.cat_name),1)])]),a("div",yt,[kt,a("span",Ct,g(c(e).article.img_source),1)])])])]),a("div",St,[n(O,{html:c(e).article.content},null,8,["html"])])])]),_:1}),a("div",wt,[r.value?(f(),y("i",{key:0,class:"iconfont iconstarton stared",title:"\u53D6\u6D88\u6536\u85CF",onClick:V})):(f(),y("i",{key:1,class:"iconfont iconstaroff",title:"\u6536\u85CF",onClick:M}))]),n(P,{onSaveComment:E,comments:c(e).comments,total:l.value,onLoadAdd:z,btnLoading:_.value,addLoading:h.value},null,8,["comments","total","btnLoading","addLoading"])]))}}};var Rt=W(Lt,[["__scopeId","data-v-5ece90e8"]]);export{Rt as default};
